{
  "id": "2c7bdd07-a611-4670-93f2-cb58603b2c9e",
  "prevId": "26d8fb63-adcb-4514-a424-9c91c5c8fda4",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.lock_table": {
      "name": "lock_table",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "integer",
          "primaryKey": true,
          "notNull": true,
          "identity": {
            "type": "always",
            "name": "lock_table_id_seq",
            "schema": "public",
            "increment": "1",
            "startWith": "1",
            "minValue": "1",
            "maxValue": "2147483647",
            "cache": "1",
            "cycle": false
          }
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.quests": {
      "name": "quests",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "integer",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar",
          "primaryKey": false,
          "notNull": true
        },
        "pointsReward": {
          "name": "pointsReward",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "isActive": {
          "name": "isActive",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "isRepeatable": {
          "name": "isRepeatable",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "quests_name_idx": {
          "name": "quests_name_idx",
          "columns": [
            {
              "expression": "name",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "quests_is_active_idx": {
          "name": "quests_is_active_idx",
          "columns": [
            {
              "expression": "isActive",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "quests_is_repeatable_idx": {
          "name": "quests_is_repeatable_idx",
          "columns": [
            {
              "expression": "isRepeatable",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "quests_name_unique": {
          "name": "quests_name_unique",
          "nullsNotDistinct": false,
          "columns": [
            "name"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.referrals": {
      "name": "referrals",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "integer",
          "primaryKey": true,
          "notNull": true,
          "identity": {
            "type": "always",
            "name": "referrals_id_seq",
            "schema": "public",
            "increment": "1",
            "startWith": "1",
            "minValue": "1",
            "maxValue": "2147483647",
            "cache": "1",
            "cycle": false
          }
        },
        "userId": {
          "name": "userId",
          "type": "varchar(36)",
          "primaryKey": false,
          "notNull": true
        },
        "referralCode": {
          "name": "referralCode",
          "type": "varchar",
          "primaryKey": false,
          "notNull": true
        },
        "referralCount": {
          "name": "referralCount",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "referrals_user_id_idx": {
          "name": "referrals_user_id_idx",
          "columns": [
            {
              "expression": "userId",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "referrals_referral_code_idx": {
          "name": "referrals_referral_code_idx",
          "columns": [
            {
              "expression": "referralCode",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "referrals_referralCode_unique": {
          "name": "referrals_referralCode_unique",
          "nullsNotDistinct": false,
          "columns": [
            "referralCode"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_quests": {
      "name": "user_quests",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "integer",
          "primaryKey": true,
          "notNull": true,
          "identity": {
            "type": "always",
            "name": "user_quests_id_seq",
            "schema": "public",
            "increment": "1",
            "startWith": "1",
            "minValue": "1",
            "maxValue": "2147483647",
            "cache": "1",
            "cycle": false
          }
        },
        "userId": {
          "name": "userId",
          "type": "varchar(36)",
          "primaryKey": false,
          "notNull": true
        },
        "questName": {
          "name": "questName",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "user_quests_user_id_idx": {
          "name": "user_quests_user_id_idx",
          "columns": [
            {
              "expression": "userId",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "user_quests_quest_name_idx": {
          "name": "user_quests_quest_name_idx",
          "columns": [
            {
              "expression": "questName",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "user_quests_user_quest_idx": {
          "name": "user_quests_user_quest_idx",
          "columns": [
            {
              "expression": "userId",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "questName",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_tokens": {
      "name": "user_tokens",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "integer",
          "primaryKey": true,
          "notNull": true,
          "identity": {
            "type": "always",
            "name": "user_tokens_id_seq",
            "schema": "public",
            "increment": "1",
            "startWith": "1",
            "minValue": "1",
            "maxValue": "2147483647",
            "cache": "1",
            "cycle": false
          }
        },
        "userId": {
          "name": "userId",
          "type": "varchar(36)",
          "primaryKey": false,
          "notNull": false,
          "default": "''"
        },
        "publicAddress": {
          "name": "publicAddress",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": true
        },
        "walletType": {
          "name": "walletType",
          "type": "varchar",
          "primaryKey": false,
          "notNull": true
        },
        "accessToken": {
          "name": "accessToken",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "refreshToken": {
          "name": "refreshToken",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "user_tokens_user_id_idx": {
          "name": "user_tokens_user_id_idx",
          "columns": [
            {
              "expression": "userId",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "user_tokens_public_address_idx": {
          "name": "user_tokens_public_address_idx",
          "columns": [
            {
              "expression": "publicAddress",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "user_tokens_wallet_type_idx": {
          "name": "user_tokens_wallet_type_idx",
          "columns": [
            {
              "expression": "walletType",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "user_tokens_refresh_token_idx": {
          "name": "user_tokens_refresh_token_idx",
          "columns": [
            {
              "expression": "refreshToken",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_tokens_user_address_unique": {
          "name": "user_tokens_user_address_unique",
          "nullsNotDistinct": false,
          "columns": [
            "userId",
            "publicAddress"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.user_wallets": {
      "name": "user_wallets",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "integer",
          "primaryKey": true,
          "notNull": true,
          "identity": {
            "type": "always",
            "name": "user_wallets_id_seq",
            "schema": "public",
            "increment": "1",
            "startWith": "1",
            "minValue": "1",
            "maxValue": "2147483647",
            "cache": "1",
            "cycle": false
          }
        },
        "userId": {
          "name": "userId",
          "type": "varchar(36)",
          "primaryKey": false,
          "notNull": true
        },
        "address": {
          "name": "address",
          "type": "varchar",
          "primaryKey": false,
          "notNull": true
        },
        "walletType": {
          "name": "walletType",
          "type": "varchar",
          "primaryKey": false,
          "notNull": true
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "user_wallets_user_id_idx": {
          "name": "user_wallets_user_id_idx",
          "columns": [
            {
              "expression": "userId",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "user_wallets_address_idx": {
          "name": "user_wallets_address_idx",
          "columns": [
            {
              "expression": "address",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "user_wallets_wallet_type_idx": {
          "name": "user_wallets_wallet_type_idx",
          "columns": [
            {
              "expression": "walletType",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "user_wallets_user_address_unique": {
          "name": "user_wallets_user_address_unique",
          "nullsNotDistinct": false,
          "columns": [
            "userId",
            "address"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.users": {
      "name": "users",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "varchar(36)",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false
        },
        "xHandle": {
          "name": "xHandle",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false,
          "default": "''"
        },
        "mainEvm": {
          "name": "mainEvm",
          "type": "varchar(255)",
          "primaryKey": false,
          "notNull": false,
          "default": "''"
        },
        "referrerCode": {
          "name": "referrerCode",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false,
          "default": "''"
        },
        "cookieConsent": {
          "name": "cookieConsent",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false,
          "default": "null"
        },
        "faceSignUserId": {
          "name": "faceSignUserId",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false
        },
        "faceSignToken": {
          "name": "faceSignToken",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false,
          "default": "null"
        },
        "faceSignTokenCreatedAt": {
          "name": "faceSignTokenCreatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false
        },
        "popCredentialId": {
          "name": "popCredentialId",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false,
          "default": "null"
        },
        "createdAt": {
          "name": "createdAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "updatedAt": {
          "name": "updatedAt",
          "type": "timestamp",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "main_evm_idx": {
          "name": "main_evm_idx",
          "columns": [
            {
              "expression": "mainEvm",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "referrer_code_idx": {
          "name": "referrer_code_idx",
          "columns": [
            {
              "expression": "referrerCode",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "name_idx": {
          "name": "name_idx",
          "columns": [
            {
              "expression": "name",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "x_handle_idx": {
          "name": "x_handle_idx",
          "columns": [
            {
              "expression": "xHandle",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "users_id_unique": {
          "name": "users_id_unique",
          "nullsNotDistinct": false,
          "columns": [
            "id"
          ]
        },
        "users_name_unique": {
          "name": "users_name_unique",
          "nullsNotDistinct": false,
          "columns": [
            "name"
          ]
        },
        "users_faceSignUserId_unique": {
          "name": "users_faceSignUserId_unique",
          "nullsNotDistinct": false,
          "columns": [
            "faceSignUserId"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {
    "public.leaderboard_view": {
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": false,
          "notNull": true
        },
        "userId": {
          "name": "userId",
          "type": "varchar(36)",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false
        },
        "xHandle": {
          "name": "xHandle",
          "type": "varchar",
          "primaryKey": false,
          "notNull": false
        },
        "questPoints": {
          "name": "questPoints",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "socialPoints": {
          "name": "socialPoints",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "contributionPoints": {
          "name": "contributionPoints",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "referralCount": {
          "name": "referralCount",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "totalPoints": {
          "name": "totalPoints",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "rank": {
          "name": "rank",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        }
      },
      "definition": "\n  WITH quest_aggregates AS (\n    SELECT \n      uq.\"userId\",\n      uq.\"questName\",\n      COUNT(*) as completion_count,\n      q.\"pointsReward\",\n      q.\"isRepeatable\"\n    FROM \"user_quests\" uq\n    LEFT JOIN \"quests\" q ON uq.\"questName\" = q.\"name\"\n    WHERE q.\"isActive\" = true\n    GROUP BY uq.\"userId\", uq.\"questName\", q.\"pointsReward\", q.\"isRepeatable\"\n  ),\n  quest_points AS (\n    SELECT \n      qa.\"userId\",\n      COALESCE(SUM(\n        CASE \n          WHEN qa.\"isRepeatable\" = true THEN qa.completion_count * qa.\"pointsReward\"\n          ELSE LEAST(1, qa.completion_count) * qa.\"pointsReward\"\n        END\n      ), 0) as quest_points\n    FROM quest_aggregates qa\n    GROUP BY qa.\"userId\"\n  ),\n  referral_quest_points AS (\n    SELECT \"pointsReward\"\n    FROM \"quests\"\n    WHERE \"name\" = 'referral_program'\n    LIMIT 1\n  ),\n  quest_points_with_referrals AS (\n    SELECT \n      u.\"id\" as \"userId\",\n      (\n        COALESCE(qp.quest_points, 0) + COALESCE(r.\"referralCount\", 0) * COALESCE(rqp.\"pointsReward\", 0)\n      ) * \n      CASE \n        WHEN COALESCE(r.\"referralCount\", 0) >= 1000 THEN 3\n        WHEN COALESCE(r.\"referralCount\", 0) >= 100 THEN 2.75\n        WHEN COALESCE(r.\"referralCount\", 0) >= 25 THEN 2.5\n        WHEN COALESCE(r.\"referralCount\", 0) >= 5 THEN 2\n        ELSE 1\n      END as quest_points,\n      COALESCE(r.\"referralCount\", 0) as \"referralCount\"\n    FROM \"users\" u\n    LEFT JOIN quest_points qp ON qp.\"userId\" = u.\"id\"\n    LEFT JOIN \"referrals\" r ON r.\"userId\" = u.\"id\"\n    CROSS JOIN referral_quest_points rqp\n  )\n  SELECT \n    ROW_NUMBER() OVER (ORDER BY COALESCE(qpr.quest_points, 0) DESC, u.\"name\" ASC) as \"id\",\n    u.\"id\" as \"userId\",\n    u.\"name\",\n    u.\"xHandle\",\n    COALESCE(qpr.quest_points, 0) as \"questPoints\",\n    0 as \"socialPoints\",\n    0 as \"contributionPoints\",\n    COALESCE(qpr.\"referralCount\", 0) as \"referralCount\",\n    COALESCE(qpr.quest_points, 0) as \"totalPoints\",\n    DENSE_RANK() OVER (ORDER BY COALESCE(qpr.quest_points, 0) DESC) as \"rank\"\n  FROM \"users\" u\n  LEFT JOIN quest_points_with_referrals qpr ON qpr.\"userId\" = u.\"id\"\n  ORDER BY \"totalPoints\" DESC, u.\"name\" ASC\n",
      "name": "leaderboard_view",
      "schema": "public",
      "isExisting": false,
      "materialized": true
    }
  },
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}